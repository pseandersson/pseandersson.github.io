<!DOCTYPE html>
<html>

<head>
  <title>Chinese Checker</title>
  <style type="text/css">
    div {

      background: green;
    }

    #board {
      background: none;
      display: flex;
      width: 95vmin;
      height: 95vmin;
      flex-direction: column;
      border: 1px solid blueviolet;
    }

    .row {
      display: flex;
      flex-direction: row;
      width: 100%;
      gap: calc(2*5vmin/13);
      height: max-content;
      justify-content: center;
    }

    .spot {
      display: inline-block;
      width: calc(95vmin / 14 - 2px);
      height: calc(95vmin / 14 - 2px);
      border-radius: calc(95vmin / 14 - 2px);
      border: 1px solid black;
      background: aqua;

    }

    .row:nth-child(1n+5) .spot:nth-child(1n + 10) {
       background: green;
    }

    .row:nth-child(1n+10) .spot:nth-child(1n + 10) {
      background: orange;
    }

    .row:nth-child(1n+5) .spot:nth-last-child(1n +10) {
      background: yellow;
    }

    .row:nth-child(1n+10) .spot:nth-last-child(1n +10) {
      background: violet;
    }

    .row:nth-child(1n+5) {
      background: white;
    }

    .row:nth-child(1n+5) .spot {
      background: white;
    }

    .row:nth-child(1n+14) .spot {
      background: red;
    }

    .home {
      border-style: dotted;
    }
  </style>
  <script>

    function setupBoard() {

      const rows = [1, 2, 3, 4, 13, 12, 11, 10, 9, 10, 11, 12, 13, 4, 3, 2, 1]
      rows.forEach(spots => {
        const row = document.createElement("div")

        row.classList.add("row")
        for (var i = 0; i < spots; i++) {
          const spot = document.createElement("div")
          spot.classList.add("spot")
          row.appendChild(spot)
        }
        document.getElementById("board").appendChild(row)
      })
      
      const centers = new Array();
      
      let collection = document.getElementsByClassName("spot")
      for (var i = 0; i < collection.length; i++) {
        let spot = collection[i]
        centers.push({
          node: spot, 
          x: spot.clientLeft + spot.clientWidth / 2,
          y: spot.clientTop + spot.clientHeight / 2,
          neighbors: new Array(),
          state: 0
        })
      }
      
      let r2 = 1.1 * (Math.pow(centers[0].x - centers[1].x, 2) + Math.pow(centers[0].y - centers[1].y, 2))
      
      for (var i = 0; i < centers.length; i++) {
        let ci = centers[i]
        for (var j = i + 1; j < centers.length; j++) {
          let cj = centers[j]
          let cr2 = (Math.pow(ci.x - cj.x, 2) + Math.pow(ci.y - cj.y, 2))
          
          if (cr2 <= r2) {
            ci.neighbors.push(cj)
            cj.neighbors.push(ci)
          }
        }
      }

      let tips = [];
      for (var i = 0; i < centers.length; i++) {
        if (centers[i].neighbors.length === 2) {
          tips.push(centers[i])
        }
      }
      debug.innerText += centers.length + " zzz "

      debug.innerText += tips.map(v=> v.neighbors.length)

      for (var i = 0; i < tips.length; i++) {
        let tip = tips[i]
        tip.node.classList.add("home")
        for (var j = 0; j < tip.neighbors.length; j++) {
          let tip2 = tip.neighbors[j]
          tip2.node.classList.add("home")
          for (var k = 0; k < tip2.neighbors.length;k++){
            let tip3 = tip2.neighbors[k]
            tip3.node.classList.add("home")
          }
        }
      }


    }
  </script>
</head>

<body>
  <h1>Chinese Checker</h1>
  <div id="gamesetup">
    <p>Number of players</p>
    <select id="numOfPlayers">
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>6</option>
    </select>
    <button>Start</button>
  </div>
  <div id="board">
  </div>
  <div id="debug"></div>
  <script>
    try {
      setupBoard()
    } catch (err) {
      document.getElementById("board").innerText = err.message
    }

  </script>
</body>

</html>